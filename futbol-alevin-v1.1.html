<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gestión Partido Fútbol Alevín</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/tailwindcss/2.2.19/tailwind.min.css" rel="stylesheet">
    <style>
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
            z-index: 50;
        }
        .modal-content {
            position: relative;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            padding: 20px;
            border-radius: 8px;
            max-width: 90%;
            width: 400px;
        }
        .marcador {
            width: 2rem;
            height: 2rem;
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
            margin: auto;
        }
    </style>
</head>
<body class="bg-gray-100">
    <div class="container mx-auto px-4 py-8 max-w-full md:max-w-4xl">
        <!-- Pestañas -->
        <div class="mb-4 border-b border-gray-200">
            <ul class="flex flex-wrap -mb-px" role="tablist">
                <li class="mr-2">
                    <button class="inline-block p-2 md:p-4 border-b-2 border-blue-500 text-blue-600 active" 
                            onclick="showTab('partido')" id="partido-tab">
                        Partido
                    </button>
                </li>
                <li class="mr-2">
                    <button class="inline-block p-2 md:p-4 border-b-2 border-transparent hover:border-gray-300" 
                            onclick="showTab('jugadores')" id="jugadores-tab">
                        Jugadores
                    </button>
                </li>
            </ul>
        </div>

        <!-- Tab Jugadores -->
        <div id="jugadores-content" class="hidden">
            <div class="grid grid-cols-1 gap-4 sm:grid-cols-2">
                <div class="bg-blue-100 p-4 rounded-lg">
                    <h3 class="font-bold text-lg mb-2 text-blue-800">Equipo Local</h3>
                    <textarea id="jugadoresLocal" rows="5" 
                        class="w-full p-2 border rounded"
                        placeholder="Ingresa un jugador por línea (número nombre)&#10;Ejemplo:&#10;7 Juan Pérez&#10;10 Carlos García"></textarea>
                    <button onclick="guardarJugadores('local')" 
                        class="mt-2 bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600 w-full md:w-auto">
                        Guardar Locales
                    </button>
                </div>
                
                <div class="bg-red-100 p-4 rounded-lg">
                    <h3 class="font-bold text-lg mb-2 text-red-800">Equipo Visitante</h3>
                    <textarea id="jugadoresVisitante" rows="5" 
                        class="w-full p-2 border rounded"
                        placeholder="Ingresa un jugador por línea (número nombre)&#10;Ejemplo:&#10;7 Juan Pérez&#10;10 Carlos García"></textarea>
                    <button onclick="guardarJugadores('visitante')" 
                        class="mt-2 bg-red-500 text-white px-4 py-2 rounded hover:bg-red-600 w-full md:w-auto">
                        Guardar Visitantes
                    </button>
                </div>
            </div>
        </div>

        <!-- Tab Partido -->
        <div id="partido-content">
            <!-- Marcador -->
            <div class="grid grid-cols-3 gap-4 md:grid-cols-3 mb-6 text-center">
                <div class="bg-blue-100 p-2 rounded-lg flex flex-col items-center">
                    <h3 class="font-bold text-lg mb-1 text-blue-800">Local</h3>
                    <div id="golesLocal" class="text-xl font-bold text-blue-600 marcador">0</div>
                </div>
                <div class="bg-gray-100 p-2 rounded-lg flex items-center justify-center">
                    <div id="tiempo" class="text-lg font-bold">00:00</div>
                </div>
                <div class="bg-red-100 p-2 rounded-lg flex flex-col items-center">
                    <h3 class="font-bold text-lg mb-1 text-red-800">Visitante</h3>
                    <div id="golesVisitante" class="text-xl font-bold text-red-600 marcador">0</div>
                </div>
            </div>

            <!-- Botones de acciones -->
            <div class="grid grid-cols-2 gap-4 mb-6">
                <div class="space-y-4">
                    <h3 class="font-bold text-center text-blue-800">Local</h3>
                    <button onclick="registrarIncidencia('gol', 'local')" 
                        class="w-full bg-blue-500 text-white text-sm px-3 py-2 rounded-md hover:bg-blue-600">
                        Gol
                    </button>
                    <button onclick="registrarIncidencia('amarilla', 'local')" 
                        class="w-full bg-yellow-500 text-white text-sm px-3 py-2 rounded-md hover:bg-yellow-600">
                        Tarjeta Amarilla
                    </button>
                    <button onclick="registrarIncidencia('roja', 'local')" 
                        class="w-full bg-red-500 text-white text-sm px-3 py-2 rounded-md hover:bg-red-600">
                        Tarjeta Roja
                    </button>
                </div>
                <div class="space-y-4">
                    <h3 class="font-bold text-center text-red-800">Visitante</h3>
                    <button onclick="registrarIncidencia('gol', 'visitante')" 
                        class="w-full bg-red-500 text-white text-sm px-3 py-2 rounded-md hover:bg-red-600">
                        Gol
                    </button>
                    <button onclick="registrarIncidencia('amarilla', 'visitante')" 
                        class="w-full bg-yellow-500 text-white text-sm px-3 py-2 rounded-md hover:bg-yellow-600">
                        Tarjeta Amarilla
                    </button>
                    <button onclick="registrarIncidencia('roja', 'visitante')" 
                        class="w-full bg-red-500 text-white text-sm px-3 py-2 rounded-md hover:bg-red-600">
                        Tarjeta Roja
                    </button>
                </div>
            </div>

            <!-- Registro de incidencias -->
            <div class="bg-white p-4 rounded-lg shadow mb-6">
                <h3 class="font-bold text-lg mb-2">Incidencias del Partido</h3>
                <div id="incidencias" class="space-y-2">
                    <!-- Las incidencias se agregarán aquí dinámicamente -->
                </div>
            </div>

            <!-- Controles del cronómetro -->
            <div class="flex flex-wrap justify-center gap-2 mb-6">
                <button id="iniciarBtn" onclick="toggleCronometro()" 
                    class="bg-green-500 text-white text-sm px-6 py-2 rounded-md hover:bg-green-600">
                    Iniciar
                </button>
                <button onclick="iniciarSegundaParte()" 
                    class="bg-yellow-500 text-white text-sm px-6 py-2 rounded-md hover:bg-yellow-600">2ª Parte
                </button>
                <button onclick="resetPartido()" 
                    class="bg-red-500 text-white px-6 py-2 rounded-lg hover:bg-red-600">Reset
                </button>
            </div>
        </div>
    </div>

    <!-- Modal para seleccionar jugador -->
    <div id="modalJugador" class="modal">
        <div class="modal-content bg-white">
            <h3 class="font-bold text-lg mb-4">Seleccionar Jugador</h3>
            <select id="selectJugador" class="w-full p-2 border rounded mb-4">
                <!-- Las opciones se llenarán dinámicamente -->
            </select>
            <div class="flex justify-end space-x-2">
                <button onclick="cerrarModal()" 
                    class="bg-gray-500 text-white px-4 py-2 rounded hover:bg-gray-600">
                    Cancelar
                </button>
                <button onclick="confirmarJugador()" 
                    class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600">
                    Confirmar
                </button>
            </div>
        </div>
    </div>

    <script>
        let cronometroInterval;
        let tiempo = 0;
        let cronometroActivo = false;
        let partidoData = {
            golesLocal: 0,
            golesVisitante: 0,
            incidencias: [],
            jugadoresLocal: [],
            jugadoresVisitante: []
        };
        let incidenciaActual = null;
        let startTimestamp = null;

        // Cargar datos guardados
        function cargarDatos() {
            const datosGuardados = localStorage.getItem('partidoData');
            if (datosGuardados) {
                partidoData = JSON.parse(datosGuardados);
                actualizarUI();
            }
            
            const tiempoGuardado = localStorage.getItem('tiempo');
            const timestampGuardado = localStorage.getItem('startTimestamp');
            const cronometroActivoGuardado = localStorage.getItem('cronometroActivo') === 'true';

            if (tiempoGuardado) {
                tiempo = parseInt(tiempoGuardado);
                if (cronometroActivoGuardado && timestampGuardado) {
                    const tiempoPasado = Math.floor((Date.now() - parseInt(timestampGuardado)) / 1000);
                    tiempo += tiempoPasado;
                }
                actualizarTiempo();
            }

            if (cronometroActivoGuardado) {
                toggleCronometro(true);
            }
        }

        // Guardar datos
        function guardarDatos() {
            localStorage.setItem('partidoData', JSON.stringify(partidoData));
            localStorage.setItem('tiempo', tiempo.toString());
            localStorage.setItem('cronometroActivo', cronometroActivo);
            if (cronometroActivo) {
                localStorage.setItem('startTimestamp', startTimestamp);
            } else {
                localStorage.removeItem('startTimestamp');
            }
        }

        // Actualizar UI
        function actualizarUI() {
            document.getElementById('golesLocal').textContent = partidoData.golesLocal;
            document.getElementById('golesVisitante').textContent = partidoData.golesVisitante;
            
            const incidenciasDiv = document.getElementById('incidencias');
            incidenciasDiv.innerHTML = '';
            partidoData.incidencias.forEach(inc => {
                const div = document.createElement('div');
                div.className = `p-2 rounded ${inc.equipo === 'local' ? 'bg-blue-100' : 'bg-red-100'}`;
                div.textContent = `${inc.minuto}' - ${inc.tipo.toUpperCase()} - ${inc.jugador} (${inc.equipo})`;
                incidenciasDiv.appendChild(div);
            });

            // Cargar jugadores en textareas
            document.getElementById('jugadoresLocal').value = partidoData.jugadoresLocal.join('\n');
            document.getElementById('jugadoresVisitante').value = partidoData.jugadoresVisitante.join('\n');
        }

        // Gestión del cronómetro
        function toggleCronometro(restore = false) {
            if (!cronometroActivo || restore) {
                if (!restore) {
                    startTimestamp = Date.now();
                }
                cronometroInterval = setInterval(() => {
                    tiempo++;
                    actualizarTiempo();
                    guardarDatos();
                }, 1000);
                document.getElementById('iniciarBtn').textContent = 'Pausar';
                document.getElementById('iniciarBtn').classList.replace('bg-green-500', 'bg-yellow-500');
            } else {
                clearInterval(cronometroInterval);
                document.getElementById('iniciarBtn').textContent = 'Reanudar';
                document.getElementById('iniciarBtn').classList.replace('bg-yellow-500', 'bg-green-500');
            }
            cronometroActivo = !cronometroActivo;
            guardarDatos();
        }

        function actualizarTiempo() {
            const minutos = Math.floor(tiempo / 60);
            const segundos = tiempo % 60;
            document.getElementById('tiempo').textContent = 
                `${minutos.toString().padStart(2, '0')}:${segundos.toString().padStart(2, '0')}`;
        }

        function iniciarSegundaParte() {
            tiempo = 35 * 60; // 35 minutos en segundos
            actualizarTiempo();
            guardarDatos();
        }

        // Gestión de jugadores
        function guardarJugadores(equipo) {
            const textarea = document.getElementById(`jugadores${equipo.charAt(0).toUpperCase() + equipo.slice(1)}`);
            const jugadores = textarea.value.split('\n').filter(j => j.trim());
            partidoData[`jugadores${equipo.charAt(0).toUpperCase() + equipo.slice(1)}`] = jugadores;
            guardarDatos();
            alert('Jugadores guardados correctamente');
        }

        // Gestión de incidencias
        function registrarIncidencia(tipo, equipo) {
            if (!cronometroActivo) {
                alert('El cronómetro debe estar activo para registrar incidencias');
                return;
            }

            const modal = document.getElementById('modalJugador');
            const select = document.getElementById('selectJugador');
            select.innerHTML = '';
            
            const jugadores = partidoData[`jugadores${equipo.charAt(0).toUpperCase() + equipo.slice(1)}`];
            jugadores.forEach(jugador => {
                const option = document.createElement('option');
                option.value = jugador;
                option.textContent = jugador;
                select.appendChild(option);
            });

            incidenciaActual = { tipo, equipo };
            modal.style.display = 'block';
        }

        function confirmarJugador() {
            const jugador = document.getElementById('selectJugador').value;
            const minuto = Math.floor(tiempo / 60);
            
            const incidencia = {
                ...incidenciaActual,
                jugador,
                minuto
            };

            if (incidencia.tipo === 'gol') {
                if (incidencia.equipo === 'local') {
                    partidoData.golesLocal++;
                } else {
                    partidoData.golesVisitante++;
                }
            }

            partidoData.incidencias.push(incidencia);
            guardarDatos();
            actualizarUI();
            cerrarModal();
        }

        function cerrarModal() {
            document.getElementById('modalJugador').style.display = 'none';
            incidenciaActual = null;
        }

        // Gestión de pestañas
        function showTab(tabName) {
            document.getElementById('partido-content').classList.add('hidden');
            document.getElementById('jugadores-content').classList.add('hidden');
            document.getElementById('partido-tab').classList.remove('border-blue-500', 'text-blue-600');
            document.getElementById('jugadores-tab').classList.remove('border-blue-500', 'text-blue-600');
            document.getElementById(`${tabName}-content`).classList.remove('hidden');
            document.getElementById(`${tabName}-tab`).classList.add('border-blue-500', 'text-blue-600');
        }

        // Inicialización cuando se carga la página
        document.addEventListener('DOMContentLoaded', () => {
            cargarDatos();
            showTab('partido');
        });

        function resetPartido() {
            if (confirm('¿Estás seguro de que quieres reiniciar el partido? Se perderán todos los datos.')) {
                // Reiniciar datos del partido
                partidoData = {
                    golesLocal: 0,
                    golesVisitante: 0,
                    incidencias: [],
                    jugadoresLocal: partidoData.jugadoresLocal,
                    jugadoresVisitante: partidoData.jugadoresVisitante
                };
                tiempo = 0;
                clearInterval(cronometroInterval);
                cronometroActivo = false;
                document.getElementById('iniciarBtn').textContent = 'Iniciar';
                document.getElementById('iniciarBtn').classList.replace('bg-yellow-500', 'bg-green-500');
                
                // Limpiar almacenamiento local
                localStorage.removeItem('partidoData');
                localStorage.removeItem('tiempo');
                localStorage.removeItem('cronometroActivo');
                localStorage.removeItem('startTimestamp');
                
                // Actualizar almacenamiento y UI
                actualizarUI();
                actualizarTiempo();
            }
        }
    </script>
</body>
</html>
